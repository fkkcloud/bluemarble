angular.module('app').controller('PostsCtrl', function ($scope, PostsSvc, $window, $document){	/* emit broadcast for current pageId */	$scope.$emit('pagechange', $scope.pageId.post);	$scope.posts = [];	var _page = 0;	var _perPage = 10;	/* move to post's location */	$scope.moveToLoc = function(id){		var post = ($scope.posts[id]);		var location = angular.fromJson(post.sexLocation);		var googleLoc = new google.maps.LatLng(location.lat, location.lon);		$scope.map.panTo(googleLoc);		$scope.map.setZoom(16);		/* using angular-scroll to move to the top smoothly */		var top = 0;    	var duration = 480;    	$document.scrollTop(top, duration).then(function() {     		console && console.log('You just scrolled to the top!');    	});		/*$window.scroll(0, 0);*/	};	$scope.addPost = function() {		/* get autocompleted place and reset(set to undefined) */		var place = $scope.sexPlaceAutocompleted;		var location = $scope.postLocation;		console.log("location:" + location.lat + ',' + location.lon + '\n place:' + place);		var locationJSON = JSON.stringify(location);		console.log($scope.sexTime);		PostsSvc.create(		{			userName: undefined,			userAge:  undefined,			sexPlace: place,			sexTime:  $scope.sexTime,			sexTarget: $scope.sexTarget,			sexLocation: locationJSON		})		.success(function(post){			var msg = "You wanted to have sex with " + 			post.sexTarget;			swal("Great!", msg, "success");			/* manually reload markers 			using maptypeid since its most least used event, - kind of hacky way to do it			*/			google.maps.event.trigger($scope.map, 'maptypeid_changed');			$scope.posts.unshift(post);			/* reset input forms */			$scope.sexTime  = null;			$scope.sexTarget = null;		})		.error(function(data, status){			if (status == 401)			{				swal("Log-in failed", "Please log in", "error");			}			else			{				swal("Post failed", "Please complete the from correctly", "error");			}		});	};	$scope.requestFetch = function() {		PostsSvc.fetch(_page, _perPage)		.success(function(posts){			_page++;			console.log('Posts have been loaded successfully for front page');			$scope.posts = $scope.posts.concat(posts);		});	};	$scope.requestFetch();});